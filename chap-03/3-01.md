# 3.01

Escreva as sguintes consultas em SQL usando o esquema da universidade.

**a)** Achar todos os títulos dos cursos no departamento Comp. Sci. que possuem três créditos.

**b)** Achar as IDs de todos os alunos que foram lecionados por um instrutor chamado Einstein; cuide para que não haja duplicadas no resultado.

**c)** Achar o salário mais alto de qualquer instrutor.

**d)** Achar todos os instrutores que ganham o salário mais alto (pode haver mais de um com o mesmo salário).

**e)** Achar a [quantidade de] matrícula[s] de cada seção que foi oferecida no outono de 2017.

**f)** Achar o número máximo de matriculados, por todas as seções, no outono de 2017.

**g)** Achar as seções que tiveram o número máximo de matriculados no outono de 2017.

## Resposta

**a)**

```
SELECT title
FROM course
WHERE credits=3;
```

| title                     |
| ------------------------- |
| Computational Biology     |
| Robotics                  |
| Image Processing          |
| Database System Concepts  |
| Intro. to Digital Systems |
| Investment Banking        |
| World History             |
| Music Video Production    |

**b)**

```
SELECT distinct s.id
FROM student s
JOIN takes t on s.id = t.id
JOIN teaches tt on t.course_id = tt.course_id
JOIN instructor i on tt.id = i.id
WHERE i.name = 'Einstein'
```

| id    |
| ----- |
| 44553 |

### 3.01 - c)

```
SELECT MAX(salary)
FROM instructor
```

| max      |
| -------- |
| 95000.00 |

### 3.01 - d)

```
SELECT id, name, salary
FROM instructor
WHERE salary = (
  SELECT MAX(salary)
  FROM instructor
)
```

| id    | name     | salary   |
| ----- | -------- | -------- |
| 22222 | Einstein | 95000.00 |

### 3.01 - e)

```
SELECT t.course_id, t.sec_id, count(id) AS takers
FROM takes t
WHERE semester = 'Fall' and year = '2017'
GROUP BY course_id, t.sec_id
ORDER BY takers desc
```

Alternatively:
```
SELECT s.course_id, s.sec_id,
  (SELECT COUNT(*)
   FROM takes t
   WHERE t.course_id = s.course_id
    AND t.semester = s.semester
    AND t.year = s.year
    AND t.sec_id = s.sec_id)
  AS takers
FROM section s
WHERE semester = 'Fall' AND year = '2017'
```

| course_id | sec_id | takers |
| --------- | ------ | ------ |
| CS-101    | 1      | 6      |
| CS-347    | 1      | 2      |
| PHY-101   | 1      | 1      |

### 3.01 - f)

```
SELECT MAX(takers) from (
  SELECT t.course_id, t.sec_id, COUNT(id) AS takers
  FROM takes t
  WHERE semester = 'Fall' AND year = '2017'
  GROUP BY course_id, t.sec_id
)
```

| max |
| --- |
| 6   |

### 3.01 - g)

```
WITH enrollment(course_id, sec_id, takers) AS (
  SELECT t.course_id, t.sec_id, count(id) AS takers
  FROM takes t
  WHERE semester = 'Fall' AND year = '2017'
  GROUP BY course_id, t.sec_id
)
SELECT e.course_id, e.sec_id
FROM enrollment e
WHERE takers = (SELECT MAX(takers) FROM enrollment)
```

| course_id | sec_id |
| --------- | ------ |
| CS-101    | 1      |