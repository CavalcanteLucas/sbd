# 2.9

O **operador de divisão** da álgebra relacional, "$\div$", é definido da seguinte forma: considere que $r(R)$ e $s(S)$ sejam relações e que $S \subseteq R$; ou seja, cada atributo do esquema $S$ também deve estar no esquema $R$. Dada a tupla $t$, considere que $t[S]$ indique a projeção da tupla $t$ sobre os atributos em $S$. Logo, $r \div s$ é uma relação no esquema $R - S$ (ou seja, no eesquema contentando todos os atributos do esquema $R$ que não estão no esquema $S$). Uma tupla $t$ está em $r \div s$ se, e somente se, estas duas condições forem verdadeiras:

- $t$ está em $\prod_{R-S}(r)$
- Para cada tupla $t_s$ em $s$, existe uma tupla $t_r$ em $r$ que satisfaz os seguintes:
    - $t_r[S] = t_s[S]$
    - $t_r[R-S] = t$

Dada essa definição:

**a)** Escreva uma expressão da álgebra relacional usando o operador de divisão para achar as IDs de todos os alunos que realizarm todos os cursos de Comp. Sci. (Dica: projete $realiza$ apenas para $ID$ e $id\_curso$ e gere o conjunto de todos os $id\_curso$ Comp. Sci. usando uma expressão de seleção, antes de realizar a divisão.)

**b)** Mostre como escrever a consulta anterior na álgebra relacional, sem usar a divisão. (Ao fazer isso, você terá mostrado como definir a operação de divisião usando outras operações da álgebra relacional.)

## Resposta

**a)**

$$
\begin{align*}
&r\leftarrow\prod\nolimits_{ID, id\_curso}(realiza) \\
&s\leftarrow\prod\nolimits_{id\_curso}(\sigma_{nome\_dept=``Comp.Sci."}(curso)) \\
&c\leftarrow\prod\nolimits_{ID}(r\div s)
\end{align*}
$$

**b)**

Primeiro, obtemos a relação e todos os alunos e cursos realizados:

$$
\begin{align*}
&A\leftarrow\prod\nolimits_{ID, id\_curso}(realiza)
\end{align*}
$$

Seguno, obtemos todos os cursos de *Comp.Sci.*:

$$
\begin{align*}
&B\leftarrow\prod\nolimits_{id\_curso}(\sigma_{nome\_dept=``Comp.Sci."}(curso))
\end{align*}
$$

Com isso, obtemos o produto cartesiano entre todos os alunos que realizaram cursos e todos os cursos de *Comp.Sci.* Esse conjunto descreveria a situação em que todos os alunos realizassem todos os cursos desse departamento:

$$
\begin{align*}
&B\leftarrow\prod\nolimits_{ID}(A) \times B
\end{align*}
$$

Em seguida, obtemos a relação de todos os alunos que **não** realizaram todos os cursos desse departamento.

$$
\begin{align*}
&D\leftarrow\prod\nolimits_{ID, id\_curso}(C - A)
\end{align*}
$$

Finalmente, obtemos todos os alunos que cursaram todos os cursos desse departamento.

$$
\begin{align*}
&E\leftarrow\prod\nolimits_{ID}(A) - \prod\nolimits_{ID}(D)
\end{align*}
$$

Substituindo, temos:

$$
\begin{align*}
E\leftarrow&\prod\nolimits_{ID}(\prod\nolimits_{ID, id\_curso}(realiza))\quad - \\
&\prod\nolimits_{ID}(\prod\nolimits_{ID, id\_curso}(C-A)) \\

\leftarrow&\prod\nolimits_{ID}(\prod\nolimits_{ID, id\_curso}(realiza))\quad - \\
&\prod\nolimits_{ID}( \\
&\qquad\prod\nolimits_{ID, id\_curso}( \\
&\qquad\qquad(\prod\nolimits_{ID}(A) \times B) - A \\
&\qquad) \\
&) \\

\leftarrow&\prod\nolimits_{ID}(\prod\nolimits_{ID, id\_curso}(realiza))\quad - \\
&\prod\nolimits_{ID}( \\
&\qquad\prod\nolimits_{ID, id\_curso}( \\
&\qquad\qquad( \\
&\qquad\qquad\qquad\prod\nolimits_{ID}(\prod\nolimits_{ID, id\_curso}(realiza))\quad\times \\
&\qquad\qquad\qquad\prod\nolimits_{id\_curso}(\sigma_{nome\_dept=``Comp.Sci."}(curso)) \\
&\qquad\qquad)\quad - \\
&\qquad\qquad\prod\nolimits_{ID, id\_curso}(realiza) \\
&\qquad) \\
&) \\

\end{align*}
$$
